---
layout: presentation
title: SQLite Intro
permalink: /sqlite-intro/
---

class: center, middle

# SQLite
Database Design

---

# Agenda

1. [Overview](#overview)
2. [Setup](#setup)
3. [CRUD](#crud)
4. [Import data](#import-data)
5. [Simple reads](#simple-reads)
6. [Functions](#functions)
7. [Grouping](#grouping)
8. [Combinations](#combinations)
9. [Conclusions](#conclusions)

---

name: overview
class: center, middle

# Overview

---

## Features
A small, lightweight, portable relational database:
- zero configuration
- serverless
- simple file format
- cross-platform compatible
- manifest typing
- small footprint
- public domain source code
- industry-proven

---

name: setup
class: center, middle

# Setup

---

## Installation
- Follow [these instructions](https://www.tutorialspoint.com/sqlite/sqlite_installation.htm) to install on your local machine.
- Or use `sqlite3` on the CS department's `i6` web server.

---

name: start

## Start
Run from the command shell. 

Replace `database_name` with a database name of your choosing:
```bash
sqlite3 database_name.db
```

If all goes swell, you are now in the SQLite command prompt.  

And if a database with this name didn't previously exist, it has now been created.

---

name: quit

## Quit
To quit SQLite, use the `.quit` helper function:
```sqlite3
.quit
```

Now go and [re-start](#start) again!

---

name: crud
class: center, middle

# CRUD

---

## Overview
Data operations fall into one of four types:
- **C**reate - creating new data
- **R**ead - viewing existing data
- **U**pdate - updating existing data
- **D**elete - deleting existing data

These operations are affectionately known as data CRUD.

---

## Definition

"crud" definition from [wordnik.com](https://www.wordnik.com/words/crud):
> n.	A coating or an incrustation of filth or refuse.
>
> n.	Something loathsome, despicable, or worthless.

Welcome to the world of data!

---

## Create

Create operations are enacted with one of two techniques:
- creating new records in a table using the `insert` command
- importing records from a file into a table using the `.import` function

```sqlite3
insert into students (first_name, last_name, net_id) values ("Foo", "Barstein", "fb1258");
```

```sqlite3
.import /Users/foobar/some_directory/students.csv students
```

---

## Read

Read operations are performed with the `select` command

```sqlite3
select first_name from students where net_id="fb1258";
```

---

## Update

Update operations are performed with the `update` command

```sqlite3
update students set first_name="Baz" where net_id="fb1258";
```

Updates to the overall schema of the table can be done with the `alter table` command
```sqlite3
alter table students add column n_number int;
```

---

## Delete

Delete can be one of a few types:
- Delete a particular record using the `delete` command
- Drop an entire table using the `drop table` command

```sqlite3
delete from students where net_id="fb1258";
```

```sqlite3
drop table students;
```

---

name: import-data
class: center, middle

# Import data

---

## Create table
We will work with data on [school districts from the 2010 US census](https://www.census.gov/geographies/reference-files/time-series/geo/gazetteer-files.2010.html) This includes each district's...
- name
- state
- lowest grade taught
- highest grade taught
- population
- number of households
- land area
- water area
- geocoordinates (latitude & longitude)

We need a table in SQLite that will accommodate this.

---

name: create-table

## Create table
Create a table to accommodate the US Census school district data:

```sqlite3
DROP TABLE IF EXISTS sd;
CREATE TABLE sd (
  sd_state text,
  sd_geoid text,
  sd_name text,
  sd_lowestGrade text,
  sd_highestGrade text,
  sd_pop_2010 integer,
  sd_hu_2010 integer,
  sd_aland real,
  sd_awater real,
  sd_aland_sqmi real,
  sd_awater_sqmi real,
  sd_intptlat real,
  sd_intptlong real,
  PRIMARY KEY(sd_geoid)
);
```

The primary key, the unique identifier of each record, is set to be the `sd_geoid` field.

---

## View list of tables
To view a list of any tables that exist in this database, use the `.tables` function.
```sqlite3
.tables
```

---

## View table schema
Viewing the `schema` of the `sd` table shows the command used to create it:
```sqlite
.schema sd
```

---

name: import-data

## Import data
Import from a [comma-separated values (CSV) file](../files/sqlite/sd.csv) of US census data on school districts into an SQLite table named `sd`... replace the path to the .csv file with one that works with your file system:
```sqlite
.mode csv
.import /Users/foobar/some_directory/sd.csv sd
```

---

## Drop table
Delete the `sd` table:
```sqlite
drop table sd
```

Now go [create it](#create-table) and [import data into it](#import-data) again!

---

## Use a script
Saving the commands to create and import data into [an SQL script](../files/sqlite/sd_setup_script.sql) can save time and effort - you can re-create and re-import data at any time by simply executing the script.

Change the file path to whatever path works on your system:
```sqlite
.read /Users/foobar/some_directory/sd_setup_script.sql
```

---

## Share a database
If you want to copy a database or share it with someone (or yourself), simply pass around a copy of [the database file](../files/sqlite/sd.db) with the data in it.

And then [quit](#quit) and [re-start](#start) SQLite using that database file.  No need to create tables from scratch or import anything.
```sqlite 3
.quit
```

```bash
sqlite3 sd.db
```

Being a portable, small footprint, simple file format database has its advantages.

---

## Dot functions
You have no-doubt noticed our use of some `dot functions`, such as:
- .quit - quit SQLite
- .tables - view a list of tables in the database
- .schema ?table name? - show the schema of a table 
- .mode ?mode? - change the way data is formatted on screen, either as `csv` or `columns`
- .import ?CSV file? ?table name? - import a data file into a table
- .read ?SQL script? - run an SQL script file

SQLite comes with several handy 

---

name: simple-reads
class: center, middle

# Simple reads

---

## All school districts
Show all fields of all records.... there are a lot.
```sqlite3
select * from sd;
```

---

## School districts in New York State
The `where` clause filters results to only those within New York.... there are a lot.
```sqlite3
select * from sd where sd_state = "NY";
```

---

## Show only school district names
Each records contains many fields.  Limit to just the `name` of each school district:
```sqlite3
select sd_name from sd where sd_state = "NY";
```

Multiple fields can be selected by supplying a comma-separated list, such as `sd_name, sd_state`.

---

## Sort the results
Sort the records by school district name in reverse alphabetic order:
```sqlite3
select sd_name from sd where sd_state = "NY" order by sd_name desc;
```

`asc` can be used to indicate ascending order.

---

## Limit the results
Show only the first 5 in the reverse-alphabetic list of New York school districts:
```sqlite3
select sd_name from sd where sd_state = "NY" order by sd_name desc limit 5;
```

---

## Offset the results
Show the second and third `pages` with 5 results each:
```sqlite3
select sd_name from sd where sd_state = "NY" order by sd_name desc limit 5 offset 5;
```

```sqlite3
select sd_name from sd where sd_state = "NY" order by sd_name desc limit 5 offset 10;
```

---

## Smallest school districts
The 10 smallest school districts in the country:
```sqlite3
select sd_name, sd_state, sd_pop_2010 from sd order by sd_pop_2010 asc limit 10;
```

---

name: functions
class: center, middle

# Functions

---

## Concept
There are a variety of [built-in aggregate functions](https://sqlite.org/lang_aggfunc.html) available to be used in queries. These are used to calculate aggregate statistics from the records returned by any query.

---

## Counting records
Calculate how many school districts exist in the US and Puerto Rico using the `count()` function.
```sqlite3
select count(sd_geoid) from sd;
```

The primary key field, `sd_geoid` is guaranteed to be unique for each record, while other fields may not be.

---

## Counting records in a filtered result set
Count the number of school districts in New York State by filtering results with a `where` clause.
```sqlite3
select count(sd_geoid) from sd where sd_state = "NY";
```

---

## Calculating average
Calculate the average population of school districts across the US, using the `avg()` function.
```sqlite3
select avg(sd_pop_2010) from sd;
```

This will return a floating point number. There are no half people, so we could round the result using the `round()` function, as in `round( avg(sd_pop_2010) )`.

---

## Calculating sum
Calculate the total population in the country, using the `sum()` function.
```sqlite3
select sum(sd_pop_2010) from sd;
```

---

name: grouping
class: center, middle

# Grouping

---

## Concept
Grouping records together by some attributes they share in common allows us to calculate aggregate statistics.

---

## Counting school districts per state
Counting the number of school districts per state requires us to group together all school districts in each state:
```sqlite3
select count(sd_geoid) from sd group by sd_state;
```

---

## Counting school districts per state... better
The previous query showed us the numbers, but not which state they represented.

View the state name *and* the number of school districts in each state:
```sqlite3
select sd_state, count(sd_geoid) from sd group by sd_state;
```

---

## Counting school districts per state in descending order
The state name and the number of school districts in each state, in descending order:
```sqlite3
select sd_state, count(sd_geoid) from sd group by sd_state order by count(sd_geoid) desc;
```

Note that the clause, `order by count(sd_geoid)` treats the count as if it were like any other field to sort by.  We can make this easier to write by using an alias:
```sqlite3
select sd_state, count(sd_geoid) as num_districts from sd group by sd_state order by num_districts desc;
```

---

## Calculating the 3 most populous states
Sort states by aggregate population in descending order, then limit to the first 3 records.
```sqlite3
select sd_state, sum(sd_pop_2010) as pop from sd group by sd_state order by pop desc limit 3;
```

---

## Calculating the 3 least populous states
Sort states by aggregate population in ascending order, then limit to the first 3 records.
```sqlite3
select sd_state, sum(sd_pop_2010) as pop from sd group by sd_state order by pop asc limit 3;
```

---

name: combinations
class: center, middle

# Combinations

---

## Concept
Let's take what we've learned a step further.

---

## All of New England
New England is made of several states.  Let's find the top ten largest school districts in this combined region using an `in` operator:
```sqlite3
select sd_name, sd_state, sd_pop_2010 from sd where sd_state in ("ME", "VT", "NH", "MA", "RI") ORDER BY sd_pop_2010 desc limit 10;
```

---

## Highest population density school districts
Which school districts have the highest population density?
```sqlite3
select sd_name, sd_state, round(sd_pop_2010 / sd_aland_sqmi) as density from sd order by density desc limit 10;
```

---

## Lowest population density school districts
Which school districts have the lowest population density?
```sqlite3
select sd_name, sd_state, round(sd_pop_2010 / sd_aland_sqmi) as density from sd order by density asc limit 10;
```

This query will return a bunch of school districts with the name including the text, "School District Not Defined"... let's exclude these:
```sqlite3
select sd_name, sd_state, round(sd_pop_2010 / sd_aland_sqmi) as density from sd where sd_name not like "%not defined%" order by density asc limit 10;
```

---

## Highest population density states
Which states have the highest population density?
```sqlite3
select sd_state, round( sum(sd_pop_2010) / sum(sd_aland_sqmi) ) as density from sd group by sd_state order by density desc limit 10;
```

---

## Lowest population density states
Which states have the lowest population density?
```sqlite3
select sd_state, round( sum(sd_pop_2010) / sum(sd_aland_sqmi) ) as density from sd group by sd_state order by density asc limit 10;
```

---

class: center, middle

# Conclusions

---

# Conclusions
Thank you. Bye.

